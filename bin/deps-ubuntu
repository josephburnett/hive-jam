#!/usr/bin/env bash

set -e

if [ "$(whoami)" != "root" ]; then
    echo "Please run as root (sudo)."
    exit 1
fi

MIN_DISTRO=Ubuntu
MIN_MAJOR=16
MIN_MINOR=04

if [ -z ${DISTRO+x} ] || [ -z ${MINOR+x} ] || [ -z ${MAJOR+x} ]; then
    DISTRO=$( lsb_release -i -s )
    MAJOR=$( lsb_release -r -s | awk -F '.' '{ print $1 }' )
    MINOR=$( lsb_release -r -s | awk -F '.' '{ print $2 }' )
fi

echo "${DISTRO?} ${MAJOR?}.${MINOR?} detected."

fail_min() {
    echo "$MIN_DISTRO $MIN_MAJOR.$MIN_MINOR or later required."
    exit 1
}

if [ "$DISTRO" != "$MIN_DISTRO" ]; then
    fail_min
fi

if [ "$MAJOR" -lt "$MIN_MAJOR" ]; then
    fail_min
fi

if [ "$MAJOR" -eq "$MIN_MAJOR" ] && [ "$MINOR" -lt "$MIN_MINOR" ]; then
    fail_min
fi

apt-get install -y \
     default-jre \
     golang-go \
     sonic-pi \
     icecast2 \
     darkice \
     jackd
